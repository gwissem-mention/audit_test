// n√©cessite un lien (id getQuestionnaires) avec pour href, l'url du formulaire
tinymce.PluginManager.add('questionnaire', function(editor, url) {

    // Add a button that opens a window
    editor.addButton('questionnaire', {
        text: 'Questionnaire',
        icon: false,
        onclick: function() {
            $.fancybox.open( $('#getQuestionnaires').val(), {
                type     : "ajax",
                autoSize : false,
                width    : 800,
                height   : 280,
                ajax     : {
                    data : {
                        texte : editor.selection.getContent({format: 'text'})
                    },
                    type : "POST"
                },
                beforeClose : function(){
                    if( $('#choix').val() == "submit" ){
                        var questionnaire = $('#questionnaire').val();
                        if( questionnaire != "" ){
                            var texte = $('#texte').val();
                            var cible = $('#cible').val();
                            editor.insertContent('[' + questionnaire + ';' + texte + ';' + cible + ']');
                        }
                    }
                }
            });
        }
    });
});