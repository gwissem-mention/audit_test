<?php

namespace HopitalNumerique\QuestionnaireBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * QuestionnaireRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class QuestionnaireRepository extends EntityRepository
{    
    /**
     * Récupère les questions/réponses d'un questionnaire
     *
     * @return array
     */
    public function getQuestionsReponses( $idQuestionnaire, $idUser )
    {
        $qb = $this->_em->createQueryBuilder();
        $qb->select('questionnaire, question, reponse')
        ->from('\HopitalNumerique\QuestionnaireBundle\Entity\Question', 'question')
        ->innerJoin('question.questionnaire', 'questionnaire' ,'WITH' , 'questionnaire.id = :idQuestionnaire')
        ->setParameter('idQuestionnaire', $idQuestionnaire )
        ->leftJoin('question.reponses', 'reponse', 'WITH' , 'reponse.user = :idUser ')
//         ->innerJoin('reponse.user', 'user' , 'WITH' , 'user.id = :idUser')
        ->setParameter('idUser', $idUser )
        ->orderBy('question.ordre');
                
        return $qb->getQuery()->getResult();
    }
}
