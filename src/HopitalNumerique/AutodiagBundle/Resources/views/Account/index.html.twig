{% extends 'HopitalNumeriqueAccountBundle::layout.html.twig' %}

{% block stylesheets %}
    {{parent()}}
    {% stylesheets output="compiled/hopitalnumerique-user-autodiag.css" filter="cssrewrite, ?yui_css"
        'bundles/hopitalnumeriqueautodiag/css/account.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{parent()}}
{% endblock %}

{% block headerTitle %}{{ 'ad.account.title'|trans }}{% endblock %}

{% block content %}

    <div class="col-md-12 domain-choice">
        <div class="row-account">
            <p>{{ 'ad.account.domain_selection'|trans }}</p>
        </div>
        <div class="row-account">
            <select>
                {% for domaine in domainesUser %}
                    <option value="domaine_{{ domaine.id }}">{{ domaine.nom }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="clearfix"></div>

    <h2>{{ 'ad.account.in_progress'|trans }}</h2>
    <div class="col-md-12">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>{{ 'ad.account.table.name'|trans }}</th>
                <th>{{ 'ad.account.table.last_save_date'|trans }}</th>
                <th>{{ 'ad.account.table.filling'|trans }}</th>
                <th style="width: 142px;"></th>
            </tr>
            </thead>
            <tbody>
                {% if datasForSyntheses.currentSyntheses is empty %}
                    <tr><td colspan="4" class="autodiag-title">{{ 'ad.account.table.none'|trans }}</td></tr>
                {% else %}
                    {% for autodiag in datasForSyntheses.currentSyntheses %}
                        <tr><td colspan="4" class="autodiag-title">{{ autodiag.name }}</td></tr>
                        {% for synthesis in autodiag.syntheses %}
                            <tr>
                                <td>{{ synthesis.name }}</td>
                                <td>{{ synthesis.updated_at|date('d/m/Y') }}</td>
                                <td>{{ synthesis.completion }}%</td>
                                <td>
                                    {% if synthesis.entryId is not null %}
                                        <a href="{{ path('hopitalnumerique_autodiag_entry_edit', {'entry': synthesis.entryId}) }}" class="btn btn-success" title="{{ 'ad.account.action.continue'|trans }}"><i class="fa fa-arrow-right"></i></a>
                                    {% endif %}
                                    <a href="#" class="btn btn-danger" title="{{ 'ad.account.action.delete'|trans }}"><i class="fa fa-trash-o"></i></a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>

    <form action="{{ path('hopitalnumerique_autodiag_account_generate_synthesis') }}" method="post">
    <h2>{{ 'ad.account.valid'|trans }}</h2>
    <div class="col-md-12">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th></th>
                <th>{{ 'ad.account.table.name'|trans }}</th>
                <th>{{ 'ad.account.table.validation_date'|trans }}</th>
                <th>{{ 'ad.account.table.share'|trans }}</th>
                <th style="width: 142px;"></th>
            </tr>
            </thead>
            <tbody>
                {% if datasForSyntheses.validSyntheses is empty %}
                    <tr><td colspan="5" class="autodiag-title">{{ 'ad.account.table.none'|trans }}</td></tr>
                {% else %}
                    {% for autodiag in datasForSyntheses.validSyntheses %}
                        <tr><td colspan="5" class="autodiag-title">{{ autodiag.name }}</td></tr>
                        {% for synthesis in autodiag.syntheses %}
                            <tr>
                                <td><input name="synthesis-choice[{{ autodiag.id }}][]" type="checkbox" value="{{ synthesis.id }}"></td>
                                {% if synthesis.entries|length > 1 %}
                                    <td>[{{ 'ad.account.synthesis.name'|trans }}] {{ synthesis.name }}</td>
                                {% else %}
                                    <td>{{ synthesis.name }}</td>
                                {% endif %}
                                <td>{{ synthesis.validated_at|date('d/m/Y') }}</td>
                                <td>
                                    {% if synthesis.user != user and synthesis.share is not empty %}
                                        Partagé par : {{ synthesis.user.prenom ~ ' ' ~ synthesis.user.nom }}
                                    {% elseif synthesis.share is not empty %}
                                        Partagé avec : {{ synthesis.share|join(', ') }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ path('hopitalnumerique_autodiag_restitution_index', {'synthesis': synthesis.id}) }}" class="btn btn-success" title="{{ 'ad.account.action.results'|trans }}"><i class="fa fa-bar-chart-o"></i></a>
                                    {% if synthesis.user == user and synthesis.entries|length <= 1 %}
                                        <a href="{{ path('hopitalnumerique_autodiag_unvalidate', {'synthesis': synthesis.id}) }}" class="btn btn-warning" title="{{ 'ad.account.action.reopen'|trans }}"><i class="fa fa-arrow-up"></i></a>
                                    {% endif %}
                                    <a href="#" class="btn btn-danger" title="{{ 'ad.account.action.delete'|trans }}"><i class="fa fa-trash-o"></i></a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>

    {% if datasForSyntheses.validSyntheses is not empty %}
        <div class="col-md-12 synthesis-creation">
            <div class="row-account">
                {{ 'ad.account.synthesis.create.label'|trans }}
            </div>
            <div class="row-account">
                <input type="text" name="synthesis-name" class="form-control">
            </div>
            <div class="row-account">
                <input type="submit" class="btn btn-success" value="{{ 'ad.account.synthesis.create.button'|trans }}">
            </div>
        </div>
    {% endif %}

    </form>

    <div class="clearfix"></div>

{% endblock %}

