{% extends 'HopitalNumeriqueCoreBundle:Templates:layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets output="compiled/hopitalnumerique-core-3.css" filter="cssrewrite, ?yui_css"
        'bundles/hopitalnumeriquecore/css/Templates/1/layout.css'
    %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
    {% stylesheets output="compiled/hopitalnumerique-core-ie8-3.css" filter="cssrewrite, ?yui_css"
        'bundles/hopitalnumeriquecore/css/Templates/3/ie8.css'
    %}
        <!--[if IE 8]>
            <link rel="stylesheet" href="{{ asset_url }}" />
        <![endif]-->
    {% endstylesheets %}
{% endblock stylesheets %}

{% block layout_body %}
    <div class="row" id="body">
        <div id="header" class="col-md-12">
            <a href="http://www.anap.fr" id="logo-header">
                <img src="/{{ domaineCurrent.getWebPath() }}" alt="{{domaineCurrent.nom}}" id="logoAnap" class="pull-left" />
            </a>
            <div id="titre" class="pull-left">
                <a href="{{ domaineCurrent.urlTitre ? domaineCurrent.urlTitre : path('hopital_numerique_homepage') }}" class="h1">{{domaineCurrent.nom}}</a>
                <div class="h2">{{domaineCurrent.description}}</div>
            </div>

            <div class="loggedUser pull-right">
                <div class="connexion">
                    {% if app.user == false %}
                        <a href="{{path('account_login')}}"><i class="fa fa-user" ></i>Se connecter</a>
                    {% endif %}
                </div>
                {% if app.user %}
                    {% if app.user.lastname or app.user.firstname %}
                        <p>
                            <i class="fa fa-user" ></i> {{ app.user.firstname|capitalize }}
                            <span class="nom">{{ app.user.lastname|capitalize }}</span>
                        </p>
                    {% else %}
                        <p>
                            <i class="fa fa-user" ></i> {{ app.user.username|capitalize }}
                        </p>
                    {% endif %}
                    <div class="connexion">
                        {% set previousAdmin = false  %}
                        {% for role in app.security.getToken().getRoles() %}
                            {% if role.getRole() == 'ROLE_PREVIOUS_ADMIN' %}
                                {% set previousAdmin = true %}
                            {% endif %}
                        {% endfor %}
                        {% if previousAdmin %}
                            <a href="{{ path('hopital_numerique_homepage', {'_switch_user': '_exit'}) }}">Quitter cet utilisateur</a>
                        {% else %}
                            <a href="{{path('account_logout')}}">Déconnexion</a>
                        {% endif %}
                    </div>
                    <a class="btn btn-success" href="{{path('hopital_numerique_user_informations_personnelles')}}">Mon compte</a>
                {% else %}
                    <a class="infos btn btn-rose" href="{{path('hopital_numerique_user_inscription')}}">Créer un compte</a>
                {% endif %}
            </div>

            <div class="common-sprite common-sprite-header"></div>
            <div class="clearfix"></div>
        </div>
        <div class="col-md-12" id="content">
            <div class="col-md-12" id="menu-container">
                {{ knp_menu_render(aliasMenuTemplateCurrent, {'currentClass': 'active', 'ancestorClass':'active','template':'HopitalNumeriqueCoreBundle::menu.html.twig'}) }}
            </div>
            <div class="clearfix"></div>

            {{ block('flashBags') }}
            {% if error is defined and error %}
                <div class="alert nalert-warning" onclick="$(this).slideUp();" >
                    {{ error.messageKey|trans(error.messageData, 'security') }}
                </div>
            {% endif %}
            {% if invalid_username is defined %}
                <div class="alert nalert-warning" onclick="$(this).slideUp();" >
                    {{ 'resetting.request.invalid_username'|trans({'%username%': invalid_username}, 'FOSUserBundle') }}
                </div>
            {% endif %}
            {% block block_du_body %}
                {% block prebody %}{% endblock prebody %}
                <div class="clearfix"></div>
                {% block body %}{% endblock body %}
                <div class="clearfix"></div>
            {% endblock %}

            <input type="hidden" id="fancy-recherche-url" value="{{path('hopital_numerique_expbesoin_rechercheFancy', {'id' : 1 })}}" />
        </div>

        {{ block('helpBlock') }}

        <div class="col-md-12" id="footer">
            {{ knp_menu_render(aliasMenuFooterTemplateCurrent, {'currentClass': 'active', 'ancestorClass':'active','template':'HopitalNumeriqueCoreBundle::menu.html.twig'}) }}

            {% if app.user %}
                <a class="reporting btn btn-xs" href="{{path('hopitalnumerique_report_homepage', {url: app.request.uri|base64Nodevo})}}">Signaler une anomalie sur cette page</a>
            {% endif %}

        </div>
    </div>

    {% if app.user and app.user|checkAuthorization( path('hopital_numerique_requete_homepage') ) %}
        <div id="mesrequetes" class="closed">
            <div class="content col-md-12" style="display:none">
                <h3 class="violet">Mes recherches</h3>
                {{ render(controller("HopitalNumeriqueRechercheBundle:Requete:index", {'indexVue':false} )) }}
                <a href="{{path('hopital_numerique_requete_homepage')}}" class="readmore"><i class="common-sprite common-sprite-arrow"></i> Gérer mes recherches</a>
            </div>
        </div>
    {% endif %}
{% endblock %}
