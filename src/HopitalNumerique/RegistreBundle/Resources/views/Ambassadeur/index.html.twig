{% extends 'HopitalNumeriqueCoreBundle::layout.html.twig' %}

{# Référencement #}
{% block title %}{{parent()}} - Registre{% endblock %}
{% block metadesc %}Registre des ambassadeurs{% endblock %}

{% block stylesheets %}
    {{parent()}}
    {% stylesheets output="compiled/hopitalnumerique-registre-ambassadeur-index.css" filter="cssrewrite"
        'bundles/hopitalnumeriqueregistre/css/style.css'
        'bundles/nodevoadmin/plugins/fancybox/jquery.fancybox.css'
    %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{parent()}}
    {% javascripts output="compiled/hopitalnumerique-registre-ambassadeur-index.js"
        'bundles/nodevoadmin/plugins/fancybox/jquery.fancybox.pack.js'
        'bundles/hopitalnumeriqueregistre/js/raphael.js'
        'bundles/hopitalnumeriqueregistre/js/carte_departement.js'
        'bundles/hopitalnumeriqueregistre/js/script.js'
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body %}
    <div id="registre-ambassadeur">
        {# En-tête #}
        <div class="col-md-12">
            <h3 class="violet">Annuaire des ambassadeurs <a href="{{path('hopital_numerique_user_informations_personnelles')}}" class="pull-right">Tableau de bord</a> </h3>
        </div> 
        
        {# Critère de recherche #}
        <div class="col-md-3">
            <h4 class="violet">Critères de recherche</h4>
            <div class="map">
                {# Liste déroulante : domaine #}
                <p class="titre">Domaines fonctionnels</p>
                <select name="domaines_liste" id="domaines_liste">
                    <option value="0"> - </option>
                    {% for domaine in domaines.domaines %}
                        <option value="{{domaine.id}}" {% if domaines.domaineSelected == domaine.id %}selected="selected"{% endif %} >{{domaine.libelle}}</option>
                    {% endfor %}
                </select>
                {# Carte de france #}
                <div id="canvas_france" style="width:100%;" ></div>

                <input type="hidden" id="selected-region" value="{{regions.regionsSelected|raw}}" />{{regions.regionsSelected|raw}}
                <p class="titre">Par zones géographiques</p>
            </div>
        </div>
        
        <div class="content col-md-9 no_padding">
			{% block content %}
			    <div class="annuaire_ambassadeur">
			    
			        {% block chapo %}
		                <div class="col-md-12">
				            <div class="chapo">
				                <h1 class="violet">Annuaire des ambassadeurs</h1>
				                <div class="description"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla luctus tincidunt purus nec adipiscing. Cras eu nisi dolor. Vestibulum laoreet mi at quam dictum, vitae iaculis metus elementum. Aliquam ut ante non ligula sollicitudin vulputate. Nullam mattis vulputate sem ut placerat. Ut ac vulputate diam. Aenean suscipit lobortis tortor sit amet pharetra. Suspendisse placerat mauris non fringilla mollis. Nulla non eleifend est. Mauris ac tincidunt dolor. Mauris venenatis sit amet eros in rutrum. Ut erat sapien, viverra id dui in.</p></div>
				            </div>
			            </div>
                        <div class="clearfix"></div>
			        {% endblock %}
			        
			        {% block contenu %}
				        {% if regions.regions %}
			                {% for region in regions.regions %}
			                    <div class="col-md-12">
				                    <h4 class="violet">{{region.libelle}}</h4>
				                </div>
				                {% for ambassadeur in ambassadeurs %}
				                    {% if ambassadeur.region.id == region.id %}
					                    <div class="fiche col-md-6">
					                        <div class="content">
					                            <h5>{{ambassadeur.prenom|capitalize ~ ' ' ~ ambassadeur.nom|capitalize}}</h5>
					                            <div class="etab">
					                                {% if ambassadeur.etablissementRattachementSante %}
					                                    {{ambassadeur.etablissementRattachementSante.nom}}
					                                {% else %}
					                                    {{ambassadeur.autreStructureRattachementSante}}
					                                {% endif %}
					                            </div>
					                            
					                            <span class="col-md-12"><a class="link violet fancybox.ajax" href="{{path('hopital_numerique_registre_ambassadeur_domaines',{'id':ambassadeur.id})}}">> Domaines fonctionnels</a></span>
					                            <span class="col-md-12"><a class="link violet fancybox.ajax" href="{{path('hopital_numerique_registre_ambassadeur_objets',{'id':ambassadeur.id})}}">> Voir tous les outils maîtrisés</a></span>
					
					                            <span class="col-md-12"><a class="btn background-violet {% if not (user.user.region.id == ambassadeur.region.id) and (user.isCMSI) %}disabled{% endif %}" href="{% if not ((user.user.region.id == ambassadeur.region.id) and (user.isCMSI)) %}#{% else %}{{path('hopital_numerique_intervention_demande_nouveau',{'ambassadeur':ambassadeur.id})}}{% endif %}">Solliciter cet ambassadeur</a></span>
					                            <div class="clearfix"></div>
					                        </div>
					                    </div>
				                    {% endif %}
				                {% endfor %}
			                {% else %}
			                    <div class="col-md-12">
			                        - Aucune régions sélectionnées - 
			                    </div>
			                {% endfor %}
			            {% else %}
			                <div class="col-md-12">
			                    <h4 class="violet">Aucune région sélectionnée</h4>
			                </div>
			                <div class="col-md-12">
			                    - Merci de sélectionner une région pour rechercher les ambassadeurs - 
			                </div>
			            {% endif %}
		                <div class="clearfix"></div>
                {% endblock contenu%}
			        
			    </div>
			{% endblock content %}

            <div class="clearfix"></div>
        </div>

        <div class="clearfix"></div>
    </div>
{% endblock body %}