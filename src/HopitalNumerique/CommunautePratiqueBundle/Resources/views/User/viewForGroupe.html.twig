{% extends 'HopitalNumeriqueCommunautePratiqueBundle::layout.html.twig' %}

{% block title_communaute_pratique %}Fiche de {{ user.prenomNom }} pour le groupe <span>{{ groupe }}</span>{% endblock %}

{% block communaute_pratique_actions %}
    {{ parent() }}
    {{ communaute_pratique.display_action_contact_animateur(groupe) }}
{% endblock %}

{% block body_communaute_pratique %}

    {{ communaute_pratique.display_bandeau_membre(user, groupe) }}

    <div class="communaute-de-pratiques-user-fiche">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#formulaire-prealable" aria-controls="formulaire-prealable" role="tab" data-toggle="tab"><em class="icon-test1"></em> &nbsp; Formulaire préalable</a></li>
            <li role="presentation"><a href="#documents" aria-controls="documents" role="tab" data-toggle="tab"><em class="icon-file148"></em> &nbsp; Documents de l'utilisateur</a></li>
            <li role="presentation"><a href="#fiches" aria-controls="fiches" role="tab" data-toggle="tab"><em class="icon-contract11"></em> &nbsp; Fiches de problématiques</a></li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="formulaire-prealable">
                {%- for reponse in questionnaireReponses -%}
                    
                    <div class="row">
                        <div class="question col-md-4">
                            {{ reponse.question.libelle }}
                        </div>
                        <div class="reponse col-md-8">
                            {{ reponse.reponse }}
                        </div>
                    </div>
                {%- endfor -%}
            </div>
            <div role="tabpanel" class="tab-pane" id="documents">
                {%- if documents|length > 0 -%}

                    <div class="pull-right">
                        
                        <select class="form-control" onchange="CommunautePratique_Document.filtreByExtensions($(this).val());">
                            <option selected="selected" value="">Filtrer par type de fichier</option>
                            {%- for fichierType in fichierTypes -%}
                                <option value="{{ fichierType.extensionValeurs|join(',') }}">{{ fichierType }}</option>
                            {%- endfor -%}
                        </select>
                    </div>

                    <p>
                        <strong><span class="violet">{{ user.prenomNom }} a déposé les documents suivants sur le groupe </span> {{ groupe }}.</strong>
                        <br>Vous pouvez cliquer sur le nom du fichier pour le télécharger.
                    </p>
                    <div class="row">
                        {%- for document in documents -%}
                            <div class="col-md-4">
                                {{ communaute_pratique.display_bloc_document(document) }}
                            </div>
                        {%- endfor -%}
                    </div>
                {%- else -%}
                    <p>
                        <strong><span class="violet">{{ user.prenomNom }} n'a pas encore déposé de documents sur le groupe </span> {{ groupe }}.</strong>
                    </p>
                {%- endif -%}

                {%- if app.user.id == user.id -%}
                    <p class="documents-lien"><a href="{{ path('hopitalnumerique_communautepratique_document_listbygroupe', { groupe:groupe.id }) }}"><em class="fa fa-angle-double-right"></em> &nbsp; Voir mon porte-documents</a></p>
                {%- endif -%}

            </div>
            <div role="tabpanel" class="tab-pane" id="fiches">

                {%- if fiches|length > 0 -%}

                    <div class="row">
                        <div class="col-md-6">
                            <p>Fiches de problématiques renseignées par <strong class="violet">{{ user.prenomNom }}</strong></p>
                        </div>
                        <div class="col-md-6 text-right">
                            <a class="btn btn-success" href="{{ path('hopitalnumerique_communautepratique_fiche_add', { groupe:groupe.id }) }}">Ajouter une fiche &nbsp; &nbsp; <em class="fa fa-plus"></em></a>
                        </div>
                    </div><br>

                    <div class="row">
                        {%- for fiche in fiches -%}
                            <div class="col-md-6">
                                <div class="communaute-de-pratiques-bloc-fiche" data-communaute-pratique-fiche-resolu="{{ fiche.resolu ? '1' : '0' }}">
                                    <div class="icone">
                                        {%- if fiche.resolu -%}
                                            <em class="icon icon-stats2"></em>
                                        {%- else -%}
                                            <em class="icon icon-stats2"></em>
                                        {%- endif -%}
                                    </div>
                                    <div class="header">
                                        <div class="date">Créée le <strong>{{ fiche.dateCreation|date('d/m/Y') }}</strong></div>
                                        <div class="commentaires">
                                            <span class="count">{{ fiche.commentaires|length }}</span> commentaire{{ fiche.commentaires|length > 1 ? 's' : '' }} sur cette fiche
                                        </div>
                                    </div>
                                    <div class="contenu">
                                        <strong>Question posée :</strong>
                                        {{ fiche.questionPosee }}
                                    </div>
                                </div>
                            </div>
                        {%- endfor -%}
                    </div>

                {%- else -%}
                    <p>Aucune fiche pour l'instant.</p>
                {%- endif -%}

            </div>
        </div>
    </div>

{% endblock body_communaute_pratique %}
