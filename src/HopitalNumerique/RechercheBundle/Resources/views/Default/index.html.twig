{% extends 'HopitalNumeriqueCoreBundle::layout.html.twig' %}

{# Référencement #}
{% block title %}{{parent()}} - Recherche{% endblock %}
{% block metadesc %}Recherche{% endblock %}

{% block stylesheets %}
    {{parent()}}
    {% stylesheets output="compiled/hopitalnumerique-recherche-default-index.css" filter="cssrewrite"
        'bundles/hopitalnumeriquerecherche/css/style.css'
    %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{parent()}}
    {% javascripts output="compiled/hopitalnumerique-recherche-default-index.js"
        'bundles/hopitalnumeriquerecherche/js/script.js'
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body %}
    <div id="recherche">
        <div class="col-md-4">
            <div id="origin">
                <ol>
                    {{ _self.buildTree(elements, 0, 'cliquable') }}
                </ol>
            </div>
        </div>

        <div class="col-md-8 requete">
            <h2 class="violet">Requête de recherche</h2>
    
            <div class="placeholder">
                <p class="text-muted">Ac ne quis a nobis hoc ita dici forte miretur, quod alia quaedam in hoc facultas sit ingeni, neque haec dicendi nobis hoc ita dici forte miretur, quod alia quaedam in hoc facultas sit ingeni, neque haec dicendi Ac ne quis a nobis hoc ita dici forte miretur, quod alia quaedam in hoc facultas sit ingeni, neque haec dicendi nobis hoc ita dici forte miretur, quod alia quaedam in hoc facultas sit ingeni, neque haec dicendi</p>
            </div>

            <div id="dest" class="row hide">
                <div class="col-md-9">
                    <h3>
                        3 Résultats
                    </h3>
                </div>
                
                <div class="col-md-3">
                    <div class="btn btn-success pull-right">Enregistrer</div>
                </div>

                <div class="col-md-12">
                    <ol class="arbo-requete" style="display:none">
                        {{ _self.buildTree(elements, 0, 'hide') }}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% macro buildTree(elements, level, class) %}
    {% if level == 0 and class == 'cliquable' %}
        {% set liClass = '' %}
    {% else %}
        {% set liClass = class %}
    {% endif %}

    {% for element in elements  %}
        
        {% if level == 1 and element.childs %}
            <li class="{{liClass}} childs level{{level}} element-{{element.id}}" data-id="{{element.id}}" >
        {% else %}
            <li class="{{liClass}} level{{level}} element-{{element.id}}" data-id="{{element.id}}" >
        {% endif %}
            <span>{{element.libelle}}</span>
            {% if element.childs %}
                {% if level == 2 and class == 'cliquable' %}
                    <i class="fa fa-chevron-right pull-right"></i>
                {% endif %}
                <ol>
                    {% for child in element.childs %}
                        {{ _self.buildTree(child, level+1, class ) }}
                    {% endfor %}
                </ol>
            {% endif %}
        </li>
    {% endfor %}
{% endmacro %}