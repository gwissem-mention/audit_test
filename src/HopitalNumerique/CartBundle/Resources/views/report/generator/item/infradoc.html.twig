{% trans_default_domain 'cart' %}

{% import _self as self %}

<h2>
    <small>{{ 'item.object_type.contenu'|trans }}</small>
    {{ item.parentsTitles|join(' > ') }} > {{ item.title }}
</h2>

{{ 'generator.infradoc.lastUpdateDate'|trans }} {{ item.lastUpdateDate|date('d/m/Y H\\hi') }}

{% if constant('HopitalNumerique\\CartBundle\\Enum\\ReportColumnsEnum::RESUME_COLUMN') in report.columns %}
    <fieldset>
        <legend>{{ 'generator.infradoc.resume'|trans }}</legend>
        {{ item.shortContent|nl2br }}
    </fieldset>
{% endif %}

{% if constant('HopitalNumerique\\CartBundle\\Enum\\ReportColumnsEnum::SUMMARY_COLUMN') in report.columns and item.children|length > 0%}
    <fieldset>
        <legend>{{ 'generator.infradoc.subChapters'|trans }}</legend>
        {{ self.buildTree(item.children) }}
    </fieldset>
{% endif %}

{% if constant('HopitalNumerique\\CartBundle\\Enum\\ReportColumnsEnum::CONTENT_COLUMN') in report.columns %}
    <fieldset>
        <legend>{{ 'generator.infradoc.resume'|trans }}</legend>
        {{ item.content|raw }}
    </fieldset>
{% endif %}

{% if constant('HopitalNumerique\\CartBundle\\Enum\\ReportColumnsEnum::COMMENT_COLUMN') in report.columns %}
    <fieldset>
        <legend>{{ 'generator.infradoc.comments'|trans }}</legend>
        {% for comment in item.comments %}
            <fieldset>
                <legend>
                    {{ comment.user.username }} - {{ comment.dateCreation|date('d/m/Y H\\hi') }}
                </legend>
                {{ comment.texte|nl2br }}
            </fieldset>
        {% endfor %}
    </fieldset>
{% endif %}

{{ include('@HopitalNumeriqueCart/report/generator/item/partials/references.html.twig') }}


{% macro buildTree(contents, chapter) %}
    {% import _self as self %}
    <ul>
        {% for content in contents %}
            <li>
                {% set name = chapter ~ content.order ~ '. ' ~ content.titre %}
                {{ name|raw }}

                {% if content.children %}
                    <ul>
                        {{ self.buildTree(content.children, chapter ~ content.order ~ '.') }}
                    </ul>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endmacro %}
